{"ast":null,"code":"var _jsxFileName = \"/Users/hariharan.thavachelvam/Documents/Sandbox/workspace/My Learning/Chapter-06/challenges-frontend/src/components/LeaderBoardComponent.js\";\nimport * as React from 'react';\nimport GameApiClient from '../services/GameApiClient';\nimport ChallengesApiClient from '../services/ChallengesApiClient';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nclass LeaderBoardComponent extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      leaderboard: [],\n      serverError: false\n    };\n  }\n  componentDidMount() {\n    this.refreshLeaderBoard();\n    // sets a timer to refresh the leaderboard every 5 seconds\n    setInterval(this.refreshLeaderBoard.bind(this), 5000);\n  }\n  getLeaderBoardData() {\n    return GameApiClient.leaderboard().then(lbRes => {\n      if (lbRes.ok) {\n        return lbRes.json();\n      } else {\n        return Promise.reject(\"Gamification: error response\");\n      }\n    });\n  }\n  getUserAliasData(userIds) {\n    return ChallengesApiClient.getUsers(userIds).then(usRes => {\n      if (usRes.ok) {\n        return usRes.json();\n      } else {\n        return Promise.reject(\"Multiplication: error response\");\n      }\n    });\n  }\n  updateLeaderBoard(lb) {\n    this.setState({\n      leaderboard: lb,\n      // reset the flag\n      serverError: false\n    });\n  }\n  refreshLeaderBoard() {\n    this.getLeaderBoardData().then(lbData => {\n      let userIds = lbData.map(row => row.userId);\n      this.getUserAliasData(userIds).then(data => {\n        // build a map of id -> alias\n        let userMap = new Map();\n        data.forEach(idAlias => {\n          userMap.set(idAlias.id, idAlias.alias);\n        });\n\n        // add a property to existing lb data\n        lbData.forEach(row => row['alias'] = userMap.get(row.userId));\n        this.updateLeaderBoard(lbData);\n      }).catch(reason => {\n        console.log('Error mapping user ids', reason);\n        this.updateLeaderBoard(lbData);\n      });\n    }).catch(reason => {\n      this.setState({\n        serverError: true\n      });\n      console.log('Gamification server error', reason);\n    });\n  }\n  render() {\n    if (this.state.serverError) {\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        children: \"We are sorry, but we cannot display game statistics at this moment.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 83,\n        columnNumber: 17\n      }, this);\n    }\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n        children: \"Leaderboard\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 88,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"table\", {\n        children: [/*#__PURE__*/_jsxDEV(\"thead\", {\n          children: /*#__PURE__*/_jsxDEV(\"tr\", {\n            children: [/*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"User\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 92,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Score\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 93,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Badges\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 94,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 91,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 90,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"tbody\", {\n          children: this.state.leaderboard.map(row => /*#__PURE__*/_jsxDEV(\"tr\", {\n            children: [/*#__PURE__*/_jsxDEV(\"td\", {\n              children: row.alias ? row.alias : row.userId\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 100,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              children: row.totalScore\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 101,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              children: row.badges.map(b => /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"badge\",\n                children: [\" \", b, \" \"]\n              }, b, true, {\n                fileName: _jsxFileName,\n                lineNumber: 103,\n                columnNumber: 42\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 102,\n              columnNumber: 33\n            }, this)]\n          }, row.userId, true, {\n            fileName: _jsxFileName,\n            lineNumber: 99,\n            columnNumber: 29\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 97,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 89,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 13\n    }, this);\n  }\n}\nexport default LeaderBoardComponent;","map":{"version":3,"names":["React","GameApiClient","ChallengesApiClient","jsxDEV","_jsxDEV","LeaderBoardComponent","Component","constructor","props","state","leaderboard","serverError","componentDidMount","refreshLeaderBoard","setInterval","bind","getLeaderBoardData","then","lbRes","ok","json","Promise","reject","getUserAliasData","userIds","getUsers","usRes","updateLeaderBoard","lb","setState","lbData","map","row","userId","data","userMap","Map","forEach","idAlias","set","id","alias","get","catch","reason","console","log","render","children","fileName","_jsxFileName","lineNumber","columnNumber","totalScore","badges","b","className"],"sources":["/Users/hariharan.thavachelvam/Documents/Sandbox/workspace/My Learning/Chapter-06/challenges-frontend/src/components/LeaderBoardComponent.js"],"sourcesContent":["import * as React from 'react';\nimport GameApiClient from '../services/GameApiClient';\nimport ChallengesApiClient from '../services/ChallengesApiClient';\n\nclass LeaderBoardComponent extends React.Component {\n\n    constructor(props) {\n        super(props);\n        this.state = {\n            leaderboard: [],\n            serverError: false\n        }\n    }\n\n    componentDidMount() {\n        this.refreshLeaderBoard();\n        // sets a timer to refresh the leaderboard every 5 seconds\n        setInterval(this.refreshLeaderBoard.bind(this), 5000);\n    }\n\n    getLeaderBoardData(): Promise {\n        return GameApiClient.leaderboard().then(\n            lbRes => {\n                if (lbRes.ok) {\n                    return lbRes.json();\n                } else {\n                    return Promise.reject(\"Gamification: error response\");\n                }\n            }\n        );\n    }\n\n    getUserAliasData(userIds: number[]): Promise {\n        return ChallengesApiClient.getUsers(userIds).then(\n            usRes => {\n                if(usRes.ok) {\n                    return usRes.json();\n                } else {\n                    return Promise.reject(\"Multiplication: error response\");\n                }\n            }\n        )\n    }\n\n    updateLeaderBoard(lb) {\n        this.setState({\n            leaderboard: lb,\n            // reset the flag\n            serverError: false\n        });\n    }\n\n    refreshLeaderBoard() {\n        this.getLeaderBoardData().then(\n            lbData => {\n                let userIds = lbData.map(row => row.userId);\n                this.getUserAliasData(userIds).then(data =>{\n                    // build a map of id -> alias\n                    let userMap = new Map();\n                    data.forEach(idAlias => {\n                        userMap.set(idAlias.id, idAlias.alias);\n                    });\n\n                    // add a property to existing lb data\n                    lbData.forEach(row =>\n                        row['alias'] = userMap.get(row.userId)\n                    );\n                    this.updateLeaderBoard(lbData);\n                }).catch (reason => {\n                    console.log('Error mapping user ids', reason);\n                    this.updateLeaderBoard(lbData)\n                });\n            }\n        ).catch(reason => {\n            this.setState({ serverError : true });\n            console.log('Gamification server error', reason);\n        });\n    }\n\n    render() {\n        if (this.state.serverError) {\n            return (\n                <div>We are sorry, but we cannot display game statistics at this moment.</div>\n            );\n        }\n        return (\n            <div>\n                <h3>Leaderboard</h3>\n                <table>\n                    <thead>\n                        <tr>\n                            <th>User</th>\n                            <th>Score</th>\n                            <th>Badges</th>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        {this.state.leaderboard.map( row =>\n                            <tr key={row.userId}>\n                                <td>{row.alias ? row.alias : row.userId}</td>\n                                <td>{row.totalScore}</td>\n                                <td>{row.badges.map(\n                                    b => <span className=\"badge\" key={b}> {b} </span>)}\n                                </td>\n                            </tr>\n                        )}\n                    </tbody>\n                </table>\n            </div>\n        );\n    }\n}\n\nexport default LeaderBoardComponent;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}